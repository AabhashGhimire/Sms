<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hand Controlled Skeleton Cube</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }
  video { display: none; }
  canvas {
    position: fixed;
    top: 0;
    left: 0;
  }
</style>
</head>

<body>

<video id="video" autoplay playsinline></video>
<canvas id="three"></canvas>

<!-- THREE.JS -->
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>

<!-- MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* ======================
   THREE SETUP
====================== */
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  75, window.innerWidth / window.innerHeight, 0.1, 1000
);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById("three"),
  antialias: true
});
renderer.setSize(window.innerWidth, window.innerHeight);

/* ======================
   LIGHT
====================== */
scene.add(new THREE.AmbientLight(0xffffff, 0.6));

const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
dirLight.position.set(5, 5, 5);
scene.add(dirLight);

/* ======================
   SKELETON / WIREFRAME CUBE
====================== */
const cubeSize = 1.8;

// base geometry (hidden)
const cubeGeo = new THREE.BoxGeometry(cubeSize, cubeSize, cubeSize);

// edges (skeleton)
const edges = new THREE.EdgesGeometry(cubeGeo);

// colored wireframe material
const edgeMaterial = new THREE.LineBasicMaterial({
  color: 0x00ffff,
  linewidth: 2
});

const cube = new THREE.LineSegments(edges, edgeMaterial);
scene.add(cube);

/* ======================
   HAND CONTROL VARS
====================== */
let targetScale = 1;
let rotX = 0;
let rotY = 0;

/* ======================
   HAND TRACKING
====================== */
const hands = new Hands({
  locateFile: f =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(res => {
  if (!res.multiHandLandmarks.length) return;

  const lm = res.multiHandLandmarks[0];

  /* ===== PINCH ZOOM ===== */
  const thumb = lm[4];
  const index = lm[8];

  const pinchDist = Math.hypot(
    thumb.x - index.x,
    thumb.y - index.y
  );

  targetScale = THREE.MathUtils.clamp(
    pinchDist * 6,
    0.6,
    3
  );

  /* ===== 4 FINGER DIRECTION ===== */
  const fingers = [lm[8], lm[12], lm[16], lm[20]];
  let avgX = 0, avgY = 0;

  fingers.forEach(f => {
    avgX += f.x;
    avgY += f.y;
  });

  avgX /= fingers.length;
  avgY /= fingers.length;

  const wrist = lm[0];
  const dx = avgX - wrist.x;
  const dy = avgY - wrist.y;

  // RESET rotation every frame (NO AUTO ROTATION)
  rotX = 0;
  rotY = 0;

  const threshold = 0.18;

  if (dx > threshold) rotY = -0.05;   // right
  if (dx < -threshold) rotY = 0.05;   // left
  if (dy < -threshold) rotX = -0.05;  // up
  if (dy > threshold) rotX = 0.05;    // down
});

/* ======================
   CAMERA FEED
====================== */
const video = document.getElementById("video");
const cam = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});
cam.start();

/* ======================
   ANIMATION LOOP
====================== */
function animate() {
  requestAnimationFrame(animate);

  // Smooth zoom
  cube.scale.lerp(
    new THREE.Vector3(targetScale, targetScale, targetScale),
    0.15
  );

  // Rotate ONLY on gesture
  cube.rotation.x += rotX;
  cube.rotation.y += rotY;

  renderer.render(scene, camera);
}
animate();

/* ======================
   RESIZE
====================== */
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
