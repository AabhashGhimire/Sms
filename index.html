<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hand Controlled Colored Cube</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
  }
  video { display: none; }
  canvas {
    position: fixed;
    top: 0;
    left: 0;
  }
</style>
</head>

<body>

<video id="video" autoplay playsinline></video>
<canvas id="three"></canvas>

<!-- THREE.JS -->
<script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>

<!-- MEDIAPIPE -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
/* ======================
   THREE SETUP
====================== */
const scene = new THREE.Scene();

const camera = new THREE.PerspectiveCamera(
  75,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({
  canvas: document.getElementById("three"),
  antialias: true
});
renderer.setSize(window.innerWidth, window.innerHeight);

/* ======================
   LIGHT
====================== */
scene.add(new THREE.AmbientLight(0xffffff, 0.6));

const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5, 5, 5);
scene.add(light);

/* ======================
   CUBE (6 DIFFERENT COLORS)
====================== */
const materials = [
  new THREE.MeshStandardMaterial({ color: 0xff0000 }), // right
  new THREE.MeshStandardMaterial({ color: 0x00ff00 }), // left
  new THREE.MeshStandardMaterial({ color: 0x0000ff }), // top
  new THREE.MeshStandardMaterial({ color: 0xffff00 }), // bottom
  new THREE.MeshStandardMaterial({ color: 0xff00ff }), // front
  new THREE.MeshStandardMaterial({ color: 0x00ffff })  // back
];

const cube = new THREE.Mesh(
  new THREE.BoxGeometry(1.6, 1.6, 1.6),
  materials
);
scene.add(cube);

/* ======================
   HAND CONTROL VARS
====================== */
let targetScale = 1;
let rotX = 0;
let rotY = 0;

/* ======================
   HAND TRACKING
====================== */
const hands = new Hands({
  locateFile: f =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 1,
  minDetectionConfidence: 0.7,
  minTrackingConfidence: 0.7
});

hands.onResults(res => {
  if (!res.multiHandLandmarks.length) return;

  const lm = res.multiHandLandmarks[0];

  /* ===== PINCH ZOOM ===== */
  const thumb = lm[4];
  const index = lm[8];

  const pinchDist = Math.hypot(
    thumb.x - index.x,
    thumb.y - index.y
  );

  targetScale = THREE.MathUtils.clamp(
    pinchDist * 6,
    0.6,
    3
  );

  /* ===== PALM TILT ROTATION ===== */
  const wrist = lm[0];
  const middleBase = lm[9]; // palm reference

  const dx = middleBase.x - wrist.x;
  const dy = middleBase.y - wrist.y;

  // RESET every frame (NO AUTO ROTATION)
  rotX = 0;
  rotY = 0;

  const threshold = 0.08;

  if (dx > threshold) rotY = -0.06;   // tilt right
  if (dx < -threshold) rotY = 0.06;   // tilt left
  if (dy < -threshold) rotX = -0.06;  // tilt up
  if (dy > threshold) rotX = 0.06;    // tilt down
});

/* ======================
   CAMERA FEED
====================== */
const video = document.getElementById("video");
const cam = new Camera(video, {
  onFrame: async () => {
    await hands.send({ image: video });
  },
  width: 640,
  height: 480
});
cam.start();

/* ======================
   ANIMATION LOOP
====================== */
function animate() {
  requestAnimationFrame(animate);

  // Smooth zoom
  cube.scale.lerp(
    new THREE.Vector3(targetScale, targetScale, targetScale),
    0.15
  );

  // Rotate ONLY when palm tilts
  cube.rotation.x += rotX;
  cube.rotation.y += rotY;

  renderer.render(scene, camera);
}
animate();

/* ======================
   RESIZE
====================== */
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
